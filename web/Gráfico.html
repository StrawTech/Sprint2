<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gráficos</title>
    <link rel="icon" type="image/jpg" href="../img/logo.jpeg"/>
    <link rel="stylesheet" href="./styles/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
    <script src="http://www.chartjs.org/dist/2.7.1/Chart.js"></script>
    <script src="http://www.chartjs.org/samples/latest/utils.js"></script>
    <style>
        canvas {
            -moz-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
        }
    </style>
</head>
<body>
    
    <header>
        <img  src="../img/logo.jpeg" width="135px" alt="Logo StrawTech">

        <ul>
            <li class="headerLi"><a href="./Home.html">Home</a></li>
            <li class="headerLi"><a href="./Gráfico.html">Gráficos</a></li>
            <li class="headerLi"><a href="./Calculadora.html">Calculadora</a></li>
            <li class="headerLi"><a href="./Produto.html">Produto</a></li>
        </ul>

            <h3 class="h3Header"><a href="./Login.html">Login</a></h3>
        
    </header>
    

    <main>
        <div>
            
            <br><br><br><br>

            <h1 style="margin-left: 20vh;">Sensor DHT 11 - Umidade</h1>
            <section style="width:90%; margin: auto;">
                <canvas id="dht11Umidade"></canvas>
            </section>
            <!-- <h1>Sensor DHT 11 - Temperatura</h1>
            <section style="width: 100%;">
                <canvas id="dht11Temperatura"></canvas> -->
            </section>
             <!-- <h1>Sensor Luminosidade</h1>
            <section style="width: 100%;">
                <canvas id="luminosidade"></canvas> -->
            </section>
            <h1 style="margin-left: 20vh; margin-top: 70px;">Sensor LM 35 - Temperatura</h1>
            <section style="width: 90%; margin: auto;">
                <canvas id="lm35Temperatura"></canvas>
            </section>
             <!-- <h1>Sensor Chave</h1>
            <section style="width: 100%;">
                <canvas id="chave"></canvas>
            </section>  -->
        </div>
    
        <script>
            /* -- dht11Umidade -- */
            var contextoDht11Umidade = document.getElementById('dht11Umidade').getContext('2d');
            contextoDht11Umidade.canvas.width = 500;
            contextoDht11Umidade.canvas.height = 150;
            var dht11Umidade = new Chart(
                contextoDht11Umidade,
                {
                    type: 'line',
                    data: {
                        labels: ['00:00', '03:00', '06:00', '9:00',
                            '12:00','15:00','18:00','21:00','00:00',],
                        datasets: [{
                            label: 'Umidade',
                            type: 'line',
                            borderColor: ['#45b3e7'],
                            fill:false,  
                        }]
                    },
                    options: {
                        scales: {
                            xAxes: [{
                                distribution: 'series',
                                ticks: {
                                    beginAtZero: true
                                }
                            }],
                            yAxes: [{
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Umidade'
                                },
                                ticks: {
                                    beginAtZero: true
                                }
                            }]
                        },
                        animation: {
                            duration: 0
                        }
                    }
                }
            );
            /* -- dht11Temperatura 
            var contextoDht11Temperatura = document.getElementById('dht11Temperatura').getContext('2d');
            contextoDht11Temperatura.canvas.width = 1000;
            contextoDht11Temperatura.canvas.height = 300;
            var dht11Temperatura = new Chart(
                contextoDht11Temperatura,
                {
                    type: 'line',
                    data: {
                        datasets: [{
                            label: "Temperatura",
                            type: 'line',
                            borderColor: ['#ff3232'],
                            backgroundColor: ['#ff7f7f']
                        }]
                    },
                    options: {
                        scales: {
                            xAxes: [{
                                distribution: 'series',
                                ticks: {
                                    beginAtZero: true
                                }
                            }],
                            yAxes: [{
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Luminosidade'
                                },
                                ticks: {
                                    beginAtZero: true
                                }
                            }]
                        },
                        animation: {
                            duration: 0
                        }
                    }
                }
            );
             luminosidade
            var contextoLuminosidade = document.getElementById('luminosidade').getContext('2d');
            contextoLuminosidade.canvas.width = 1000;
            contextoLuminosidade.canvas.height = 300;
            var luminosidade = new Chart(
                contextoLuminosidade,
                {
                    type: 'line',
                    data: {
                        datasets: [{
                            label: 'Luminosidade',
                            type: 'line',
                            borderColor: ['#ffd902'],
                            backgroundColor: ['#ffe135']
                        }]
                    },
                    options: {
                        scales: {
                            xAxes: [{
                                distribution: 'series',
                                ticks: {
                                    beginAtZero: true
                                }
                            }],
                            yAxes: [{
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Luminosidade'
                                },
                                ticks: {
                                    beginAtZero: true
                                }
                            }]
                        },
                        animation: {
                            duration: 0
                        }
                    }
                }
            ) -- */
            /* -- lm35Temperatura */
            var contextoLm35Temperatura = document.getElementById('lm35Temperatura').getContext('2d');
            contextoLm35Temperatura.canvas.width = 500;
            contextoLm35Temperatura.canvas.height = 150;
            var lm35Temperatura = new Chart(
                contextoLm35Temperatura,
                {
                    type: 'line',
                    data: {
                        datasets: [{
                            label: 'Temperatura',
                            type: 'line',
                            borderColor: ['#ffd902'],
                            fill:false
                        }]
                    },
                    options: {
                        scales: {
                            xAxes: [{
                                distribution: 'series',
                                ticks: {
                                    beginAtZero: true
                                }
                            }],
                            yAxes: [{
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Temperatura'
                                },
                                ticks: {
                                    beginAtZero: true
                                }
                            }]
                        },
                        animation: {
                            duration: 0
                        }
                    }
                }
            );
            /* -- chave 
            var contextoChave = document.getElementById('chave').getContext('2d');
            contextoChave.canvas.width = 1000;
            contextoChave.canvas.height = 300;
            var chave = new Chart(
                contextoChave,
                {
                    type: 'line',
                    data: {
                        datasets: [{
                            label: 'Chave',
                            type: 'line',
                            borderColor: ['#ffd902'],
                            backgroundColor: ['#ffe135']
                        }]
                    },
                    options: {
                        scales: {
                            xAxes: [{
                                distribution: 'series',
                                ticks: {
                                    beginAtZero: true
                                }
                            }],
                            yAxes: [{
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Chave'
                                },
                                ticks: {
                                    beginAtZero: true
                                }
                            }]
                        },
                        animation: {
                            duration: 0
                        }
                    }
                }
            );
         -- */
            var paginacao = {};
            var tempo = {};
            function obterDados(grafico, endpoint) {
                var http = new XMLHttpRequest();
                http.open('GET', 'http://localhost:3000/sensores/' + endpoint, false);
                http.send(null);
                var valores = JSON.parse(http.responseText);
                if (paginacao[endpoint] == null) {
                    paginacao[endpoint] = 0;
                }
                if (tempo[endpoint] == null) {
                    tempo[endpoint] = 0;
                }
                // Exibir à partir do último elemento exibido anteriormente
                var ultimaPaginacao = paginacao[endpoint];
                paginacao[endpoint] = valores.length;
                var valores = valores.slice(ultimaPaginacao);
                valores.forEach((valor) => {
                    //Máximo de 60 itens exibidos no gráfico
                    if (grafico.data.labels.length == 10 && grafico.data.datasets[0].data.length == 10) {
                        grafico.data.labels.shift();
                        grafico.data.datasets[0].data.shift();
                    }
    
                    grafico.data.labels.push(tempo[endpoint]++);
                    grafico.data.datasets[0].data.push(parseFloat(valor));
                    grafico.update();
                })
            }
    
            setInterval(() => {
                obterDados(dht11Umidade, 'dht11/umidade');
               // obterDados(dht11Temperatura, 'dht11/temperatura');
               // obterDados(luminosidade, 'luminosidade');
                obterDados(lm35Temperatura, 'lm35/temperatura');
                // obterDados(chave, 'chave');
            }, 500);
    
        </script>
    </main>

   <footer>
        <div onclick="OpenSuporte()" id="idimgOpen" class="ImgOpenSuporte" >
                <img  src="../img/suporte-tecnico.png" alt="">
        </div>



        <div  id="containerSuporte" class="containerSuporte">
          <div class="HeaderSuporte">

            <h1 class="tituloSuporte">Suporte</h1> <h1 onclick="ClosedSuporte()" class="CloseSuporte">X</h1></div>
            
            <p class="labelSuporte">Qual o problema ?</p> 
            <input class="input_decoracaoSuporte" type="text" id="input_problema"> 
           
            <p class="labelSuporte">Descrição do problema</p> 
            <textarea id="DescricaoDoPloblema" class="input_decoracaoSuporte"
                type="text"></textarea> 
            
            <p class="labeSuportel">E-mail para contato</p>
             <input id="EmailParaContato" type="email" class="input_decoracaoSuporte " type="text"> 
            <button class="buttonSuporte" onclick="enviarMsgSuporte()">Enviar</button>

        </div>
    </footer>

</body>
</html>
<script src="./scripts/scriptSuporte.js"></script>