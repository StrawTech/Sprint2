<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gráficos</title>
    <link rel="icon" type="image/jpg" href="./assets/logoIcon.png" />
    <link rel="stylesheet" href="./styles/style.css">
    <link rel="stylesheet" href="./styles/style_Gráficos.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
    <script src="http://www.chartjs.org/dist/2.7.1/Chart.js"></script>
    <script src="http://www.chartjs.org/samples/latest/utils.js"></script>
    <style>
        canvas {
            -moz-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
        }
    </style>
</head>

<body>

    <header>
        <img src="./assets/logo.jpeg" width="135px" alt="Logo StrawTech">

        <ul>
            <li class="headerLi"><a href="./Home.html">Home</a></li>
            <li class="headerLi"><a href="./Gráfico.html">Gráficos</a></li>
            <li class="headerLi"><a href="./Calculadora.html">Calculadora</a></li>
            <li class="headerLi"><a href="./Produto.html">Produto</a></li>
        </ul>

        <h3 class="h3Header"><a href="./Login.html">Login</a></h3>

    </header>


    <main>
        <br><br>
        <center>
            <h1>Gráficos</h1>
        </center>

        <br><br>

        <div class="DivDashBoardCard">
            <br>
            <h3>Média Diária</h3>
            <br>

            <div class="FlexBox alintExCenter">

                <div class="Card-MédiaMensalUmi">
                    <p style="color: #45b3e7; font-size: 20px;">Umidade %</p>
                    <p class="NumberCardMensalUmi">42,4</p>
                </div>

                <div class="Card-MédiaMensalTemp">
                    <p style="color: #FF7301; font-size: 20px;">Temperatura C°</p>
                    <p class="NumberCardMensalTemp">25,2</p>
                </div>

            </div>


        </div>

        <br><br>
        <div class="GraficosJáligadosComAPI">


            <section style="width:45%; margin: auto;">
                <p class="graficos_umAoLadodoOutro">Sensor DHT 11 - Umidade</p>
                <canvas id="dht11Umidade"></canvas>
            </section>

            <!-- <h1>Sensor DHT 11 - Temperatura</h1>
            <section style="width: 100%;">
                <canvas id="dht11Temperatura"></canvas> 
            </section>-->
            <!-- <h1>Sensor Luminosidade</h1>
            <section style="width: 100%;">
                <canvas id="luminosidade"></canvas> 
            </section>-->


            <section style="width: 45%; margin: auto;">
                <p class="graficos_umAoLadodoOutro">Sensor LM 35 - Temperatura</p>
                <canvas id="lm35Temperatura"></canvas>
            </section>

            <!-- <h1>Sensor Chave</h1>
            <section style="width: 100%;">
                <canvas id="chave"></canvas>
            </section>  -->
        </div>
        <br>
        <div class="GraficosJáligadosComAPI">


            <section style="width:45%; margin: auto;">
                <p class="graficos_umAoLadodoOutro">Média da umidade mensal</p>
                <canvas id="MédiaUmiMensal"></canvas>
            </section>

            <section style="width:45%; margin: auto;">
                <p class="graficos_umAoLadodoOutro">Média da temperatura mensal</p>
                <canvas id="MédiaTempMensal"></canvas>
            </section>

        </div>

        <br>

        <div class="DivDashBoardCard">
            <br>
            <h3>Média Mensal</h3>
            <br>
            <div class="FlexBox alintExCenter">

                <div class="Card-MédiaMensalUmi">
                    <p style="color: #45b3e7; font-size: 20px;">Umidade %</p>
                    <p class="NumberCardMensalUmi">46,9</p>
                </div>

                <div class="Card-MédiaMensalTemp">
                    <p style="color: #FF7301; font-size: 20px;">Temperatura C°</p>
                    <p class="NumberCardMensalTemp">21,09</p>
                </div>

            </div>


        </div>

        <br><br><br>

        <script>
            /* -- dht11Umidade -- */
            var contextoDht11Umidade = document.getElementById('dht11Umidade').getContext('2d');
            contextoDht11Umidade.canvas.width = 500;
            contextoDht11Umidade.canvas.height = 150;
            var dht11Umidade = new Chart(
                contextoDht11Umidade,
                {
                    type: 'line',
                    data: {
                        labels: [
                            '00:00', '03:00', '06:00', '09:00', '12:00', '15:00', '18:00', '21:00', '00:00'
                        ],
                        datasets: [{
                            label: 'Umidade',
                            type: 'line',
                            borderColor: ['#45b3e7'],
                            fill: false,
                        }]
                    },
                    options: {
                        scales: {
                            xAxes: [{
                                distribution: 'series',
                                ticks: {
                                    beginAtZero: true
                                }
                            }],
                            yAxes: [{
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Umidade'
                                },
                                ticks: {
                                    beginAtZero: true
                                }
                            }]
                        },
                        animation: {
                            duration: 0
                        }
                    }
                }
            );

            /* -- lm35Temperatura */
            var contextoLm35Temperatura = document.getElementById('lm35Temperatura').getContext('2d');
            contextoLm35Temperatura.canvas.width = 500;
            contextoLm35Temperatura.canvas.height = 150;
            var lm35Temperatura = new Chart(
                contextoLm35Temperatura,
                {
                    type: 'line',
                    data: {
                        labels: [
                            '00:00', '03:00', '06:00', '09:00', '12:00', '15:00', '18:00', '21:00', '00:00'
                        ],
                        datasets: [{
                            label: 'Temperatura',
                            type: 'line',
                            borderColor: ['#FF7301'],
                            fill: false
                        }]
                    },
                    options: {
                        scales: {
                            xAxes: [{
                                distribution: 'series',
                                ticks: {
                                    beginAtZero: true
                                }
                            }],
                            yAxes: [{
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Temperatura'
                                },
                                ticks: {
                                    beginAtZero: true
                                }
                            }]
                        },
                        animation: {
                            duration: 0
                        }
                    }
                }
            );

            /* -- Média Temperatura Mensal -- */
            var contextoMédiaTempMensal = document.getElementById('MédiaTempMensal').getContext('2d');
            contextoMédiaTempMensal.canvas.width = 500;
            contextoMédiaTempMensal.canvas.height = 150;
            var dht11Umidade = new Chart(
                contextoMédiaTempMensal,
                {
                    type: 'line',
                    data: {
                        labels: [
                            '5', '10', '15', '20', '25', '30'
                        ],
                        datasets: [{
                            label: 'Temperatura',
                            type: 'line',
                            borderColor: ['#FF7301'],
                            fill: false,
                            data: [20.1, 21.8, 23.0, 24.9, 22.0, 22.0, 23.7, 24.24, 28.8, 27.0, 21.0, 22.0, 23.0, 22.0, 21.78, 22.7, 21.4, 22.2, 22.6, 23.2, 27.9, 21.7, 22.0, 23.0, 22.4, 21.0, 23.1, 22.2, 21.6]
                        }]
                    },
                    options: {
                        scales: {
                            xAxes: [{
                                distribution: 'series',
                                ticks: {
                                    beginAtZero: true
                                }
                            }],
                            yAxes: [{
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Temperatura'
                                },
                                ticks: {
                                    beginAtZero: true
                                }
                            }]
                        },
                        animation: {
                            duration: 0
                        }
                    }
                }
            );

            /* -- Média Mensal Umidade -- */
            var contextoMédiaUmiMensal = document.getElementById('MédiaUmiMensal').getContext('2d');
            contextoMédiaUmiMensal.canvas.width = 500;
            contextoMédiaUmiMensal.canvas.height = 150;
            var contextoMédiaUmiMensal = new Chart(
                contextoMédiaUmiMensal,
                {
                    type: 'line',
                    data: {
                        labels: [
                            '5', '10', '15', '20', '25', '30'
                        ],
                        datasets: [{
                            label: 'Umidade',
                            type: 'line',
                            borderColor: ['#45b3e7'],
                            fill: false,
                            data: [50, 51, 53, 54, 55, 52, 53, 54, 58, 57, 51, 52, 53, 52, 51, 52, 51, 52, 52, 53, 57, 51, 52, 53, 52, 51, 53, 52, 51]
                        }]
                    },
                    options: {
                        scales: {
                            xAxes: [{
                                distribution: 'series',
                                ticks: {
                                    beginAtZero: true
                                }
                            }],
                            yAxes: [{
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Umidade'
                                },
                                ticks: {
                                    beginAtZero: true
                                }
                            }]
                        },
                        animation: {
                            duration: 0
                        }
                    }
                }
            );

            /* -- dht11Temperatura 
            var contextoDht11Temperatura = document.getElementById('dht11Temperatura').getContext('2d');
            contextoDht11Temperatura.canvas.width = 1000;
            contextoDht11Temperatura.canvas.height = 300;
            var dht11Temperatura = new Chart(
                contextoDht11Temperatura,
                {
                    type: 'line',
                    data: {
                        datasets: [{
                            label: "Temperatura",
                            type: 'line',
                            borderColor: ['#ff3232'],
                            backgroundColor: ['#ff7f7f']
                        }]
                    },
                    options: {
                        scales: {
                            xAxes: [{
                                distribution: 'series',
                                ticks: {
                                    beginAtZero: true
                                }
                            }],
                            yAxes: [{
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Luminosidade'
                                },
                                ticks: {
                                    beginAtZero: true
                                }
                            }]
                        },
                        animation: {
                            duration: 0
                        }
                    }
                }
            );
             luminosidade
            var contextoLuminosidade = document.getElementById('luminosidade').getContext('2d');
            contextoLuminosidade.canvas.width = 1000;
            contextoLuminosidade.canvas.height = 300;
            var luminosidade = new Chart(
                contextoLuminosidade,
                {
                    type: 'line',
                    data: {
                        datasets: [{
                            label: 'Luminosidade',
                            type: 'line',
                            borderColor: ['#ffd902'],
                            backgroundColor: ['#ffe135']
                        }]
                    },
                    options: {
                        scales: {
                            xAxes: [{
                                distribution: 'series',
                                ticks: {
                                    beginAtZero: true
                                }
                            }],
                            yAxes: [{
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Luminosidade'
                                },
                                ticks: {
                                    beginAtZero: true
                                }
                            }]
                        },
                        animation: {
                            duration: 0
                        }
                    }
                }
            ) -- */

            /* -- chave 
            var contextoChave = document.getElementById('chave').getContext('2d');
            contextoChave.canvas.width = 1000;
            contextoChave.canvas.height = 300;
            var chave = new Chart(
                contextoChave,
                {
                    type: 'line',
                    data: {
                        datasets: [{
                            label: 'Chave',
                            type: 'line',
                            borderColor: ['#ffd902'],
                            backgroundColor: ['#ffe135']
                        }]
                    },
                    options: {
                        scales: {
                            xAxes: [{
                                distribution: 'series',
                                ticks: {
                                    beginAtZero: true
                                }
                            }],
                            yAxes: [{
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Chave'
                                },
                                ticks: {
                                    beginAtZero: true
                                }
                            }]
                        },
                        animation: {
                            duration: 0
                        }
                    }
                }
            );
         -- */
            var paginacao = {};
            var tempo = {};
            function obterDados(grafico, endpoint) {
                var http = new XMLHttpRequest();
                http.open('GET', 'http://localhost:3000/sensores/' + endpoint, false);
                http.send(null);
                var valores = JSON.parse(http.responseText);
                if (paginacao[endpoint] == null) {
                    paginacao[endpoint] = 0;
                }
                if (tempo[endpoint] == null) {
                    tempo[endpoint] = 0;
                }
                // Exibir à partir do último elemento exibido anteriormente
                var ultimaPaginacao = paginacao[endpoint];
                paginacao[endpoint] = valores.length;
                var valores = valores.slice(ultimaPaginacao);
                valores.forEach((valor) => {
                    //Máximo de 60 itens exibidos no gráfico
                    if (grafico.data.labels.length == 10 && grafico.data.datasets[0].data.length == 10) {
                        grafico.data.labels.shift();
                        grafico.data.datasets[0].data.shift();
                    }

                    grafico.data.labels.push(tempo[endpoint]++);
                    grafico.data.datasets[0].data.push(parseFloat(valor));
                    grafico.update();
                })
            }

            setInterval(() => {
                obterDados(dht11Umidade, 'dht11/umidade');
                // obterDados(dht11Temperatura, 'dht11/temperatura');
                // obterDados(luminosidade, 'luminosidade');
                obterDados(lm35Temperatura, 'lm35/temperatura');
                // obterDados(chave, 'chave');
            }, 1000);

        </script>
    </main>

    <footer>
        <div onclick="OpenSuporte()" id="idimgOpen" class="ImgOpenSuporte">
            <img src="./assets/suporte-tecnico.png" alt="">
        </div>



        <div id="containerSuporte" class="containerSuporte">
            <div class="HeaderSuporte">

                <h1 class="tituloSuporte">Suporte</h1>
                <h1 onclick="ClosedSuporte()" class="CloseSuporte">X</h1>
            </div>

            <p class="labelSuporte">Qual o problema ?</p>
            <input class="input_decoracaoSuporte" type="text" id="input_problema">

            <p class="labelSuporte">Descrição:</p>
            <textarea id="DescricaoDoPloblema" class="input_decoracaoSuporte" type="text"></textarea>

            <p class="labeSuportel">E-mail para contato:</p>
            <input id="EmailParaContato" type="email" class="input_decoracaoSuporte " type="email">
            <button class="buttonSuporte" onclick="enviarMsgSuporte()">Enviar</button>

        </div>

        <div class="rodape2">
            <br><br>
            <div class="labelIcones">
                <a href="https://wa.me/+5511947693677/? text="> <img class="icones" src="./assets/whatsapp.png" alt=""></a>
                <a href="https://www.instagram.com/strawtechsp"> <img class="icones" src="./assets/instagram.png" alt=""></a>
                <a href="https://github.com/StrawTech/Sprint2"> <img class="icones" src="./assets/github.png" alt=""></a>
                <br><br>
                2023 StrawTech. Todos os direitos reservados
            </div>
            <br>
        </div>
    </footer>

</body>

</html>
<script src="./scripts/scriptSuporte.js"></script>